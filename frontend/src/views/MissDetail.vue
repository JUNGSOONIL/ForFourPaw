<template>
  <div id="app">
    <!-- main-area -->
    <main>
      <!-- breadcrumb-area -->
      <section
        class="breadcrumb-area breadcrumb-bg"
        style="background-image: url('/img/bg/drinking_cat.jpg')"
      >
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="breadcrumb-content">
                <h2 class="title">ì‹¤ì¢… ë™ë¬¼</h2>
                <nav
                  style="
                    background-color: #f5f2eb;
                    width: 270px;
                    border-radius: 15px 15px 40px 15px;
                  "
                  aria-label="breadcrumb"
                >
                  <ol style="margin-left: 20px" class="breadcrumb">
                    <li class="breadcrumb-item">
                      <router-link style="color: gray" to="/missList"
                        >ì‹¤ì¢… ë™ë¬¼ ëª©ë¡</router-link
                      >
                    </li>
                    <li class="breadcrumb-item" aria-current="page">
                      <router-link to="/missDetail">ì‹¤ì¢… ë™ë¬¼ ìƒì„¸</router-link>
                    </li>
                  </ol>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- breadcrumb-area-end -->

      <!-- shop-details-area -->
      <section class="shop-details-area pt-30 pb-60">
        <div class="container">
          <div class="shop-details-wrap">
            <div class="row">
              <h4 style="margin-left: 12px; width: 100%" class="title">
                ì‹¤ì¢… ë™ë¬¼ ìƒì„¸
              </h4>
              <div class="col-6">
                <div class="shop-details-img-wrap">
                  <div class="tab-content" id="myTabContent">
                    <div
                      class="tab-pane show active"
                      id="item-one"
                      role="tabpanel"
                      aria-labelledby="item-one-tab"
                    >
                      <div class="shop-details-img">
                        <img
                          v-if="!miss.profile"
                          src="../assets/img/image.png"
                          alt=""
                          style="
                            background-color: #bcbcbc;
                            width: 616px;
                            height: 568px;
                            border: 2px solid #f5f2eb;
                            border-radius: 10px;
                          "
                        />
                        <img
                          v-else
                          :src="miss.profile"
                          alt=""
                          style="
                            background-color: #f5f2eb;
                            width: 616px;
                            height: 568px;
                            border: 2px solid #f5f2eb;
                            border-radius: 10px;
                          "
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div
                  id="test"
                  style="
                    border-radius: 10px;
                    padding: 10px;
                    width: 586px;
                    height: 568px;
                    overflow: auto;
                    background-color: #f5f2eb;
                  "
                >
                  <div class="shop-details-price">
                    <h2 class="price">ì‚¬ëŒ ì •ë³´</h2>
                    <h5 class="stock-status">- Person</h5>
                  </div>
                  <div class="shop-details-dimension">
                    <label for="personName">ì´ë¦„</label>
                    <input
                      id="personName"
                      type="text"
                      v-model="miss.authorName"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="personTel">ì „í™”ë²ˆí˜¸</label>
                    <input
                      id="personTel"
                      type="tel"
                      v-model="miss.careTel"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                  </div>
                  <div class="shop-details-price">
                    <h2 class="price">ë™ë¬¼ ì •ë³´</h2>
                    <h5 class="stock-status">- Animal</h5>
                  </div>
                  <div class="shop-details-dimension">
                    <label for="animalName">ì´ë¦„</label>
                    <input
                      id="animalName"
                      type="text"
                      v-model="miss.name"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="animalKind">í’ˆì¢…</label>
                    <input
                      id="animalKind"
                      type="text"
                      v-model="miss.kindCd"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="animalColor">ìƒ‰ìƒ</label>
                    <input
                      id="animalColor"
                      type="text"
                      v-model="miss.colorCd"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="animalAge">ë‚˜ì´</label>
                    <input
                      id="animalAge"
                      type="text"
                      v-model="miss.age"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="animalSex">ì„±ë³„</label>
                    <input
                      id="animalSex"
                      type="text"
                      v-model="miss.sexCd"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="animalneuter">ì¤‘ì„±í™”</label>
                    <input
                      id="animalneuter"
                      type="text"
                      v-model="miss.neuterYn"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="animalHappenDay">ì‹¤ì¢…ë‚ ì§œ</label>
                    <input
                      id="animalHappenDay"
                      type="date"
                      v-model="miss.happenDt"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                    <label for="animalHappenPlace">ì‹¤ì¢…ì¥ì†Œ</label>
                    <div>
                      <input
                        id="animalHappenPlace"
                        type="text"
                        v-model="miss.happenPlace"
                        class="form-control"
                        style="background-color: white"
                        disabled
                      />
                    </div>
                    <label for="animalDesc">íŠ¹ì´ì‚¬í•­</label>
                    <textarea
                      id="animalDesc"
                      type="text"
                      v-model="miss.descr"
                      class="form-control"
                      style="background-color: white"
                      disabled
                    />
                  </div>
                </div>
                <div class="d-md-flex justify-content-md-end">
                  <span
                    v-if="this.miss.author == userInfoNo()"
                    style="margin-top: 10px"
                  >
                    <li class="header-btn">
                      <p
                        class="btn"
                        style="
                          width: 85px;
                          height: 10px;
                          font-size: 17px;
                          padding: 19px 15px;
                        "
                        @click="movepage()"
                      >
                        í¸ì§‘
                        <img src="/img/icon/w_pawprint.png" alt="" />
                      </p>
                    </li>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="product-desc-wrap" style="padding-top: 15px">
                <ul class="nav nav-tabs" id="myTabTwo" role="tablist">
                  <li class="nav-item">
                    <a
                      class="nav-link active"
                      id="review-tab"
                      data-toggle="tab"
                      href="#review"
                      role="tab"
                      aria-controls="review"
                      aria-selected="false"
                      >ì•½ê´€</a
                    >
                  </li>
                  <li v-if="miss.author == userInfoNo()" class="nav-item">
                    <a
                      class="nav-link"
                      id="details-tab"
                      data-toggle="tab"
                      href="#details"
                      role="tab"
                      aria-controls="details"
                      aria-selected="true"
                      >ğŸ’¡ ë§¤ì¹­</a
                    >
                  </li>
                  <li v-if="userInfoNo() != null" class="nav-item">
                    <a
                      class="nav-link"
                      id="comment-tab"
                      data-toggle="tab"
                      href="#comment"
                      role="tab"
                      aria-controls="comment"
                      aria-selected="true"
                      >ëŒ“ê¸€</a
                    >
                  </li>
                </ul>

                <div class="tab-content" id="myTabContentTwo">
                  <div
                    class="tab-pane fade show active"
                    id="review"
                    role="tabpanel"
                    aria-labelledby="details-tab"
                  >
                    <div class="product-desc-content">
                      <p>
                        ã€Œë™ë¬¼ë³´í˜¸ë²•ã€ ì œ17ì¡°, ì‹œí–‰ë ¹7ì¡° ë° ë™ë²• ì‹œí–‰ê·œì¹™
                        ì œ20ì¡°ì— ë”°ë¼ ìœ ê¸°Â·ìœ ì‹¤ë™ë¬¼ì„ ë³´í˜¸í•˜ê³  ìˆëŠ” ê²½ìš°ì—ëŠ”
                        ì†Œìœ ì ë“±ì´ ë³´í˜¸ì¡°ì¹˜ ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆë„ë¡ 7ì¼ ë™ì•ˆ
                        ê³µê³ í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ê³µê³  ì¤‘ì¸ ë™ë¬¼ ì†Œìœ ìëŠ” í•´ë‹¹ ì‹œêµ°êµ¬
                        ë° ë™ë¬¼ë³´í˜¸ì„¼í„°ì— ë¬¸ì˜í•˜ì‹œì–´ ë™ë¬¼ì„ ì°¾ì•„ê°€ì‹œê¸° ë°”ëë‹ˆë‹¤.
                        ë‹¤ë§Œ, ã€Œë™ë¬¼ë³´í˜¸ë²•ã€ ì œ19ì¡° ë° ë™ë²• ì‹œí–‰ê·œì¹™ ì œ21ì¡°ì—
                        ë”°ë¼ ì†Œìœ ìì—ê²Œ ë³´í˜¸ë¹„ìš©ì´ ì²­êµ¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        <br />ë˜í•œ ã€Œë™ë¬¼ë³´í˜¸ë²•ã€ ì œ17ì¡°ì— ë”°ë¥¸ ê³µê³ ê°€ ìˆëŠ”
                        ë‚ ë¶€í„° 10ì¼ì´ ê²½ê³¼í•˜ì—¬ë„ ì†Œìœ ì ë“±ì„ ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ëŠ”
                        ã€Œìœ ì‹¤ë¬¼ë²•ã€ ì œ12ì¡° ë° ã€Œë¯¼ë²•ã€ ì œ253ì¡°ì˜ ê·œì •ì—ë„
                        ë¶ˆêµ¬í•˜ê³  í•´ë‹¹ ì‹œÂ·ë„ì§€ì‚¬ ë˜ëŠ” ì‹œì¥Â·êµ°ìˆ˜Â·êµ¬ì²­ì¥ì´ ê·¸
                        ë™ë¬¼ì˜ ì†Œìœ ê¶Œì„ ì·¨ë“í•˜ê²Œ ë©ë‹ˆë‹¤.
                      </p>
                    </div>
                  </div>

                  <div
                    class="tab-pane fade show"
                    id="details"
                    role="tabpanel"
                    aria-labelledby="details-tab"
                  >
                    <div v-if="matchend" class="product-desc-content">
                      <h2 v-if="misslistslice.length != 0">
                        í˜¹ì‹œ ì´ ë™ë¬¼ì€ ì•„ë‹ˆì‹ ê°€ìš”? <br />
                        í¬í¬í¬ê°€ ì°¾ì•„ë“œë ¤ìš”!
                      </h2>
                      <h2 v-else>
                        ì£„ì†¡í•©ë‹ˆë‹¤ í˜„ì¬ ë§¤ì¹­ë˜ëŠ” ë™ë¬¼ì´ ì—†ì–´ìš”. <br />
                        ë”ìš± ë” ë…¸ë ¥í•˜ëŠ” í¬í¬í¬ê°€ ë ê²Œìš”!
                      </h2>
                    </div>
                    <div
                      v-if="misslistslice.length != 0"
                      class="row related-product-active"
                    >
                      <div
                        v-if="misslistmax > 3"
                        style="position: absolute; z-index: 1; top: 295px"
                      >
                        <p
                          @click="imgleft"
                          type="button"
                          style="margin: 0px; opacity: 0.7"
                        >
                          <img src="img/icon/arrow2.png" style="width: 60px" />
                        </p>
                      </div>
                      <div
                        v-if="misslistmax > 3"
                        style="
                          position: absolute;
                          z-index: 1;
                          top: 295px;
                          right: 0px;
                        "
                      >
                        <p
                          @click="imgright"
                          type="button"
                          style="margin: 0px; opacity: 0.7"
                        >
                          <img src="img/icon/arrow4.png" style="width: 60px" />
                        </p>
                      </div>
                      <div
                        v-for="(miss, index) in misslistslice"
                        v-bind:key="index"
                        class="col-lg-3"
                      >
                        <div class="shop-item mb-55" style="z-index: -1">
                          <div class="shop-thumb">
                            <router-link
                              :to="{
                                name: 'ShelDetail',
                                params: { no: miss.desertionNo },
                              }"
                            >
                              <img
                                :src="miss.popfile"
                                alt=""
                                style="
                                  width: 268px;
                                  height: 268px;
                                  border-radius: 50%;
                                "
                              />
                            </router-link>
                          </div>
                          <div class="shop-content">

                             <div class="shop-content-bottom">
                              <span class="price"
                                > <i class="fa fa-location-arrow"></i> &nbsp; {{ miss.orgNm }} {{ miss.happenPlace }}</span
                              >
                            </div>
                                
                            <div class="shop-content-bottom">
                              <span class="price"
                                > <i class="fa fa-phone"></i> &nbsp; {{ miss.careTel }}</span
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div
                    class="tab-pane fade show"
                    id="comment"
                    role="tabpanel"
                    aria-labelledby="comment-tab"
                  >
                    <div class="row related-product-active">
                      <div class="col-12" style="margin-top: 10px">
                        <div id="test" :style="commenntopen">
                          <div
                            v-for="(com, index) in commentlistslice"
                            v-bind:key="index"
                          >
                            <img
                              style="float: left"
                              id="comment_img"
                              :src="com.profileImage"
                              alt=""
                            />
                            <h4 style="float: left; margin: 0px">
                              {{ com.authorNickName }}
                            </h4>
                            <div
                              v-if="com.author == userInfoNo()"
                              id="setting"
                              style="cursor: pointer; float: right"
                              @click="commentdelete(com.no)"
                            >
                              <i
                                style="margin-top: 5px"
                                class="fas fa-trash"
                              ></i>
                            </div>
                            <p style="float: right">
                              {{ com.writeTime.substring(0, 10) }} &nbsp;
                            </p>
                            <br />
                            <br />
                            <p style="margin-left: 50px; margin-bottom: 5px">
                              {{ com.descr }}
                            </p>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                          </div>
                        </div>
                      </div>

                      <div class="col-12">
                        <div
                          class="shop-details-price"
                          style="margin: 3px; float: right; cursor: pointer"
                        >
                          <h5
                            class="stock-status"
                            v-if="
                              !commentstyle.toggle &&
                              commentlist != null &&
                              commentlist.length > 2
                            "
                            @click="updatecomment()"
                          >
                            ë”ë³´ê¸°
                          </h5>
                          <h5
                            class="stock-status"
                            v-if="
                              commentstyle.toggle &&
                              commentlist != null &&
                              commentlist.length > 2
                            "
                            @click="updatecomment()"
                          >
                            ì ‘ê¸°
                          </h5>
                        </div>
                      </div>

                      <div class="col-12">
                        <div
                          style="border: 2px; padding: 4px 12px; height: 50px"
                        >
                          <label
                            for="comment_input"
                            style="
                              float: left;
                              font-size: 17px;
                              margin-top: 6px;
                            "
                            >ëŒ“ê¸€</label
                          >
                          <input
                            id="comment_input"
                            type="text"
                            v-model="commentdescr"
                            class="form-control"
                            style="width: 1037px; float: left; margin: 0px 10px"
                            @keyup.enter="commentinset"
                          />
                          <p
                            class="btn"
                            style="
                              width: 85px;
                              height: 10px;
                              font-size: 17px;
                              padding: 19px 15px;
                              float: left;
                            "
                            @click="commentinset"
                          >
                            ì‘ì„±
                            <img src="/img/icon/w_pawprint.png" alt="" />
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- shop-details-area-end -->
    </main>
    <!-- main-area-end -->
  </div>
</template>

<script>
import axios from "axios";
const session = window.sessionStorage;
export default {
  name: "App",
  props: {
    no: {
      type: Number,
    },
  },
  data: function () {
    return {
      matchend: false,
      miss: {},
      commentdescr: "",
      commentlist: [],
      commentlistslice: [],
      commentstyle: {
        height: "190px",
        overflow: "hidden ",
        toggle: false,
      },
      misslist: [],
      misslistslice: [],
      misslistmin: 0,
      misslistindex: 4,
      misslistmax: 0,
    };
  },
  created() {
    this.$store.commit("setHaderindex", 2);
    this.selectMiss();
  },
  computed: {
    commenntopen() {
      return {
        border: "2px",
        padding: "4px 12px",
        height: this.commentstyle.height,
        overflow: this.commentstyle.overflow,
      };
    },
  },
  methods: {
    movepage() {
      this.$router.push({ name: "MissWrite", params: { no: this.no } });
    },
    imgleft() {
      if (this.misslistmin > 0) {
        this.misslistmin--;
        this.misslistindex--;
        this.misslistslice = null;
        this.misslistslice = this.misslist.slice(
          this.misslistmin,
          this.misslistindex
        );
      }
    },
    imgright() {
      if (this.misslistindex < this.misslistmax) {
        this.misslistmin++;
        this.misslistindex++;
        this.misslistslice = null;
        this.misslistslice = this.misslist.slice(
          this.misslistmin,
          this.misslistindex
        );
      }
    },
    userInfoNo() {
      if (session.getItem("userInfo") != null)
        return JSON.parse(session.getItem("userInfo")).no;
      return null;
    },
    commentselect() {
      this.commentlist = null;
      this.commentlistslice = null;
      let headers = {
        "at-jwt-access-token": session.getItem("at-jwt-access-token"),
        "at-jwt-refresh-token": session.getItem("at-jwt-refresh-token"),
      };
      axios({
        method: "get",
        url: "/api/comments/" + this.no, //ì—¬ê¸° ìˆ˜ì •
        headers: headers,
      })
        .then((res) => {
          this.$store.dispatch("login/accessTokenRefresh", res); // storeì•„ë‹Œê³³ì—ì„œ
          this.commentlist = res.data;
        })
        .catch((error) => {
          console.log(error);
        })
        .then(() => {
          if (this.commentlist.length == 0) {
            this.commentstyle.height = "50px";
          } else {
            this.commentstyle.height = "190px";
            this.commentlistslice = this.commentlist.slice(0, 2);
          }
        });
    },
    commentinset() {
      let headers = {
        "at-jwt-access-token": session.getItem("at-jwt-access-token"),
        "at-jwt-refresh-token": session.getItem("at-jwt-refresh-token"),
      };
      let data = {
        author: this.userInfoNo(),
        missNo: this.no,
        descr: this.commentdescr,
      };
      axios({
        method: "post",
        url: "/api/comments", //ì—¬ê¸° ìˆ˜ì •
        data: data,
        headers: headers,
      })
        .then((res) => {
          this.$store.dispatch("login/accessTokenRefresh", res); // storeì•„ë‹Œê³³ì—ì„œ
          this.$alertify.success("ì‘ì„± ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.");
          this.commentdescr = "";
          this.commentselect();
        })
        .catch((error) => {
          console.log(error);
        });
    },
    commentdelete(el) {
      let headers = {
        "at-jwt-access-token": session.getItem("at-jwt-access-token"),
        "at-jwt-refresh-token": session.getItem("at-jwt-refresh-token"),
      };
      axios({
        method: "delete",
        url: "/api/comments/" + el, //ì—¬ê¸° ìˆ˜ì •
        headers: headers,
      })
        .then((res) => {
          this.$store.dispatch("login/accessTokenRefresh", res);
          this.$alertify.success("ì‚­ì œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.");
          this.commentselect();
        })
        .catch((error) => {
          console.log(error);
        })
        .then(() => {});
    },
    updatecomment() {
      if (this.commentstyle.toggle) {
        this.commentstyle.height = "190px";
        this.commentstyle.overflow = "hidden";
        this.commentlistslice = this.commentlist.slice(0, 2);
      } else {
        this.commentstyle.height = "285px";
        this.commentstyle.overflow = "auto";
        this.commentlistslice = this.commentlist;
      }
      this.commentstyle.toggle = !this.commentstyle.toggle;
    },
    match() {
      this.$store.commit("loading/load", true);
      let headers = {
        "at-jwt-access-token": session.getItem("at-jwt-access-token"),
        "at-jwt-refresh-token": session.getItem("at-jwt-refresh-token"),
      };
      let data = {
        kindCd: this.miss.kindCd,
        colorCd: this.miss.colorCd,
        sexCd: this.miss.sexCd,
        happenPlace: this.miss.happenPlace,
      };
      axios({
        method: "post",
        url: "/api/kmeans", //ì—¬ê¸° ìˆ˜ì •
        data: data, // post ë‚˜ putì— ë°ì´í„° ë„£ì–´ ì¤„ë•Œ
        headers: headers, // ë„£ëŠ”ê±° ê¹Œë¨¹ì§€ ë§ˆì„¸ìš”
      })
        .then((res) => {
          this.$store.dispatch("login/accessTokenRefresh", res); // storeì•„ë‹Œê³³ì—ì„œ
          this.misslist = res.data;
          this.misslistslice = this.misslist.slice(
            this.misslistmin,
            this.misslistindex
          );
          this.misslistmax = this.misslist.length;
        })
        .catch((error) => {
          console.log(error);
        })
        .finally(
          () => this.$store.commit("loading/load", false),
          (this.matchend = true)
        );
    },
    selectMiss() {
      axios({
        method: "get",
        url: "/api/miss/" + this.no, // ì—¬ê¸° ìˆ˜ì •
      })
        .then((res) => {
          this.miss = res.data; // ì—¬ê¸° ìˆ˜ì •
        })
        .catch((error) => {
          console.log(error);
        })
        .then(() => {
          if (this.miss.author == this.userInfoNo()) {
            this.match();
          }
          if (this.userInfoNo() != null) {
            this.commentselect();
          }
        });
    },
  },
};
</script>

<style scoped>
#app {
}
#test::-webkit-scrollbar {
  width: 15px; /*ìŠ¤í¬ë¡¤ë°”ì˜ ë„ˆë¹„*/
}

#test::-webkit-scrollbar-thumb {
  background-color: red; /*ìŠ¤í¬ë¡¤ë°”ì˜ ìƒ‰ìƒ*/
  background-clip: padding-box;
  border: 2px solid transparent;
  border-radius: 100px;
}
#test::-webkit-scrollbar-track {
  background-color: rgba(0, 0, 0, 0); /*ìŠ¤í¬ë¡¤ë°” íŠ¸ë™ ìƒ‰ìƒ*/
}
#comment_img {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  margin-right: 0.4rem;
  margin-bottom: auto;
  margin-top: auto;
}
#setting {
  width: 1%;
  margin-left: auto;
  margin-top: auto;
  margin-bottom: auto;
}
</style>
